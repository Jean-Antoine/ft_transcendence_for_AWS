<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ping Pong Game 🎾</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #222;
            color: white;
            font-family: Arial, sans-serif;
        }
        canvas {
            border: 2px solid white;
            background-color: black;
        }
        .controls {
            margin-top: 20px;
        }
    </style>
</head>
<body>

    <h1>Ping Pong Game 🎾</h1>
    <canvas id="gameCanvas" width="500" height="300"></canvas>
    
    <div class="controls">
        <p>Use <strong>Arrow Up</strong> and <strong>Arrow Down</strong> to move your paddle.</p>
        <p>Game controls: You play against AI.</p>
    </div>

    <script>
        const socket = new WebSocket("/ws/pong/type/id/");
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");

        socket.onopen = function () {
            console.log("✅ WebSocket connected!");
        };
        
        socket.onerror = function (error) {
            console.error("❌ WebSocket error:", error);
        };
        
        socket.onclose = function () {
            console.log("🔴 WebSocket closed.");
        };

        function drawBall(x, y)
        {
            ctx.beginPath()
        }

        socket.onmessage = function(event) {
            const state = JSON.parse(event.data);
            console.log(state);
        
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "white";
        
            // Draw ball
            ctx.beginPath();
            ctx.arc(
                state.ball.x * canvas.width / 100,  // X coordinate of the ball
                state.ball.y * canvas.height / 100, // Y coordinate of the ball
                state.ball.r * canvas.width / 100,  // radius of the ball
                0,                                  // Starting angle
                Math.PI * 2                         // Ending angle -> 360 for complete circle
            );
            ctx.fill();
        
            // Draw paddles
            ctx.fillRect(
                state.left.top_left_corner.x * canvas.width / 100,
                state.left.top_left_corner.y * canvas.height / 100,
                state.left.width * canvas.width / 100,
                state.left.height * canvas.height / 100
            );
            ctx.fillRect(
                state.right.top_left_corner.x * canvas.width / 100,
                state.right.top_left_corner.y * canvas.height / 100,
                state.right.width * canvas.width / 100,
                state.right.height * canvas.height / 100
            );
        };

        // Send paddle movement when pressing arrow keys
        document.addEventListener("keydown", (event) => {
            if (event.key === "ArrowUp") {
                event.preventDefault();
                socket.send(JSON.stringify({
                    toogle_pause: false,
                    paddle_y: -5}));
            }
            else if (event.key === "ArrowDown") {
                event.preventDefault();
                socket.send(JSON.stringify({
                    toogle_pause: false,
                    paddle_y: 5}));
            }
			else if (event.key === " ") {
				event.preventDefault();
				socket.send(JSON.stringify({
                    toogle_pause: true,
                    paddle_y: 0
                }));
			}
        });
    </script>

</body>
</html>
